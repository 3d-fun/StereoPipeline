# This Makefile is just a demo of what is possible with HiRISE. I hope to
# document at some point and to get the hazard cams working.

# Users with custom paths must override this variables
EXECDIR ?= ../../bin/

# Executables
ifeq ($(EXECDIR),)
	EEXECDIR=$(EXECDIR)
else
	EEXECDIR=../$(EXECDIR)
endif
STEREO = $(EXECDIR)stereo
POINT2DEM = $(EEXECDIR)point2dem
HILLSHADE = $(EEXECDIR)hillshade
COLORMAP = $(EEXECDIR)colormap
DISPARITYDEBUG = $(EEXECDIR)disparitydebug
POINT2MESH = $(EEXECDIR)point2mesh
HIEDR2MOSAIC = $(EXECDIR)hiedr2mosaic.py

all: nonmap/nonmap-DEM_CMAP.tif

%.IMG:
	./downloader.sh $@

PSP_005201_1640_RED.mos_hijitreged.norm.cub: PSP_005201_1640_RED0_0.IMG PSP_005201_1640_RED0_1.IMG PSP_005201_1640_RED1_0.IMG PSP_005201_1640_RED1_1.IMG PSP_005201_1640_RED2_0.IMG PSP_005201_1640_RED2_1.IMG PSP_005201_1640_RED3_0.IMG PSP_005201_1640_RED3_1.IMG PSP_005201_1640_RED4_0.IMG PSP_005201_1640_RED4_1.IMG PSP_005201_1640_RED5_0.IMG PSP_005201_1640_RED5_1.IMG PSP_005201_1640_RED6_0.IMG PSP_005201_1640_RED6_1.IMG PSP_005201_1640_RED7_0.IMG PSP_005201_1640_RED7_1.IMG PSP_005201_1640_RED8_0.IMG PSP_005201_1640_RED8_1.IMG PSP_005201_1640_RED9_0.IMG PSP_005201_1640_RED9_1.IMG
	$(HIEDR2MOSAIC) $^

PSP_005913_1640_RED.mos_hijitreged.norm.cub: PSP_005913_1640_RED0_0.IMG PSP_005913_1640_RED0_1.IMG PSP_005913_1640_RED1_0.IMG PSP_005913_1640_RED1_1.IMG PSP_005913_1640_RED2_0.IMG PSP_005913_1640_RED2_1.IMG PSP_005913_1640_RED3_0.IMG PSP_005913_1640_RED3_1.IMG PSP_005913_1640_RED4_0.IMG PSP_005913_1640_RED4_1.IMG PSP_005913_1640_RED5_0.IMG PSP_005913_1640_RED5_1.IMG PSP_005913_1640_RED6_0.IMG PSP_005913_1640_RED6_1.IMG PSP_005913_1640_RED7_0.IMG PSP_005913_1640_RED7_1.IMG PSP_005913_1640_RED8_0.IMG PSP_005913_1640_RED8_1.IMG PSP_005913_1640_RED9_0.IMG PSP_005913_1640_RED9_1.IMG
	$(HIEDR2MOSAIC) $^

nonmap/nonmap-PC.tif: PSP_005913_1640_RED.mos_hijitreged.norm.cub PSP_005201_1640_RED.mos_hijitreged.norm.cub
	$(STEREO) $^ nonmap/nonmap -s stereo.nonmap

nonmap/nonmap-DEM.tif: nonmap/nonmap-PC.tif
	cd nonmap; \
	$(POINT2DEM) -r mars --nodata -32767 nonmap-PC.tif

nonmap/nonmap-DEM_CMAP.tif: nonmap/nonmap-DEM.tif
	cd nonmap; \
	$(HILLSHADE) nonmap-DEM.tif; \
	$(COLORMAP) -s nonmap-DEM_HILLSHADE.tif nonmap-DEM.tif
	$(COLORMAP) nonmap-DEMError.tif --lut ../../TriangulationError.lut

clean:
	rm -rf nonmap map *.vwip

distclean:
	rm -rf *cub *~ *.match